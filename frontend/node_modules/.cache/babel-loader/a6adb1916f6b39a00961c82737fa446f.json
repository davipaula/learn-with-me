{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport * as React from 'react';\nimport { useRef, useCallback, useEffect, useMemo } from 'react';\nimport { Form } from 'react-final-form';\nimport arrayMutators from 'final-form-arrays';\nimport useInitializeFormWithRecord from './useInitializeFormWithRecord';\nimport useWarnWhenUnsavedChanges from './useWarnWhenUnsavedChanges';\nimport sanitizeEmptyValues from './sanitizeEmptyValues';\nimport getFormInitialValues from './getFormInitialValues';\nimport { useDispatch } from 'react-redux';\nimport { setAutomaticRefresh } from '../actions/uiActions';\nimport { FormContextProvider } from './FormContextProvider';\n/**\n * Wrapper around react-final-form's Form to handle redirection on submit,\n * legacy defaultValue prop, and array inputs.\n *\n * Requires a render function, just like react-final-form\n *\n * @example\n *\n * const SimpleForm = props => (\n *    <FormWithRedirect\n *        {...props}\n *        render={formProps => <SimpleFormView {...formProps} />}\n *    />\n * );\n *\n * @typedef {Object} Props the props you can use (other props are injected by Create or Edit)\n * @prop {Object} initialValues\n * @prop {Function} validate\n * @prop {Function} save\n * @prop {boolean} submitOnEnter\n * @prop {string} redirect\n * @prop {boolean} sanitizeEmptyValues\n *\n * @param {Props} props\n */\n\nvar FormWithRedirect = function (_a) {\n  var debug = _a.debug,\n      decorators = _a.decorators,\n      defaultValue = _a.defaultValue,\n      destroyOnUnregister = _a.destroyOnUnregister,\n      form = _a.form,\n      initialValues = _a.initialValues,\n      initialValuesEqual = _a.initialValuesEqual,\n      _b = _a.keepDirtyOnReinitialize,\n      keepDirtyOnReinitialize = _b === void 0 ? true : _b,\n      _c = _a.mutators,\n      mutators = _c === void 0 ? arrayMutators : _c,\n      // FIXME see https://github.com/final-form/react-final-form/issues/704 and https://github.com/microsoft/TypeScript/issues/35771\n  record = _a.record,\n      render = _a.render,\n      save = _a.save,\n      saving = _a.saving,\n      _d = _a.subscription,\n      subscription = _d === void 0 ? defaultSubscription : _d,\n      validate = _a.validate,\n      validateOnBlur = _a.validateOnBlur,\n      version = _a.version,\n      warnWhenUnsavedChanges = _a.warnWhenUnsavedChanges,\n      _e = _a.sanitizeEmptyValues,\n      shouldSanitizeEmptyValues = _e === void 0 ? true : _e,\n      props = __rest(_a, [\"debug\", \"decorators\", \"defaultValue\", \"destroyOnUnregister\", \"form\", \"initialValues\", \"initialValuesEqual\", \"keepDirtyOnReinitialize\", \"mutators\", \"record\", \"render\", \"save\", \"saving\", \"subscription\", \"validate\", \"validateOnBlur\", \"version\", \"warnWhenUnsavedChanges\", \"sanitizeEmptyValues\"]);\n\n  var redirect = useRef(props.redirect);\n  var onSave = useRef(save);\n  var formGroups = useRef({}); // We don't use state here for two reasons:\n  // 1. There no way to execute code only after the state has been updated\n  // 2. We don't want the form to rerender when redirect is changed\n\n  var setRedirect = function (newRedirect) {\n    redirect.current = newRedirect;\n  };\n  /**\n   * A form can have several Save buttons. In case the user clicks on\n   * a Save button with a custom onSave handler, then on a second Save button\n   * without custom onSave handler, the user expects the default save\n   * handler (the one of the Form) to be called.\n   * That's why the SaveButton onClick calls setOnSave() with no parameters\n   * if it has no custom onSave, and why this function forces a default to\n   * save.\n   */\n\n\n  var setOnSave = useCallback(function (newOnSave) {\n    typeof newOnSave === 'function' ? onSave.current = newOnSave : onSave.current = save;\n  }, [save]);\n  var formContextValue = useMemo(function () {\n    return {\n      setOnSave: setOnSave,\n      getGroupFields: function (name) {\n        return formGroups.current[name] || [];\n      },\n      registerGroup: function (name) {\n        formGroups.current[name] = formGroups.current[name] || [];\n      },\n      unregisterGroup: function (name) {\n        delete formGroups[name];\n      },\n      registerField: function (source, group) {\n        if (group) {\n          var fields = new Set(formGroups.current[group] || []);\n          fields.add(source);\n          formGroups.current[group] = Array.from(fields);\n        }\n      },\n      unregisterField: function (source, group) {\n        if (group) {\n          if (!formGroups.current[group]) {\n            console.warn(\"Invalid form group \" + group);\n          } else {\n            var fields = new Set(formGroups.current[group]);\n            fields.delete(source);\n            formGroups.current[group] = Array.from(fields);\n          }\n        }\n      }\n    };\n  }, [setOnSave]);\n  var finalInitialValues = getFormInitialValues(initialValues, defaultValue, record);\n\n  var submit = function (values) {\n    var finalRedirect = typeof redirect.current === undefined ? props.redirect : redirect.current;\n\n    if (shouldSanitizeEmptyValues) {\n      var sanitizedValues = sanitizeEmptyValues(finalInitialValues, values);\n      return onSave.current(sanitizedValues, finalRedirect);\n    } else {\n      return onSave.current(values, finalRedirect);\n    }\n  };\n\n  return React.createElement(FormContextProvider, {\n    value: formContextValue\n  }, React.createElement(Form, {\n    key: version,\n    debug: debug,\n    decorators: decorators,\n    destroyOnUnregister: destroyOnUnregister,\n    form: form,\n    initialValues: finalInitialValues,\n    initialValuesEqual: initialValuesEqual,\n    keepDirtyOnReinitialize: keepDirtyOnReinitialize,\n    mutators: mutators,\n    onSubmit: submit,\n    subscription: subscription,\n    validate: validate,\n    validateOnBlur: validateOnBlur,\n    render: function (formProps) {\n      return React.createElement(FormView, __assign({}, props, formProps, {\n        record: record,\n        setRedirect: setRedirect,\n        saving: formProps.submitting || saving,\n        render: render,\n        save: save,\n        warnWhenUnsavedChanges: warnWhenUnsavedChanges\n      }));\n    }\n  }));\n};\n\nvar defaultSubscription = {\n  submitting: true,\n  pristine: true,\n  valid: true,\n  invalid: true\n};\n\nvar FormView = function (_a) {\n  var render = _a.render,\n      warnWhenUnsavedChanges = _a.warnWhenUnsavedChanges,\n      setRedirect = _a.setRedirect,\n      props = __rest(_a, [\"render\", \"warnWhenUnsavedChanges\", \"setRedirect\"]); // if record changes (after a getOne success or a refresh), the form must be updated\n\n\n  useInitializeFormWithRecord(props.record);\n  useWarnWhenUnsavedChanges(warnWhenUnsavedChanges);\n  var dispatch = useDispatch();\n  useEffect(function () {\n    dispatch(setAutomaticRefresh(props.pristine));\n  }, [dispatch, props.pristine]);\n  var redirect = props.redirect,\n      handleSubmit = props.handleSubmit;\n  /**\n   * We want to let developers define the redirection target from inside the form,\n   * e.g. in a <SaveButton redirect=\"list\" />.\n   * This callback does two things: handle submit, and change the redirection target.\n   * The actual redirection is done in save(), passed by the main controller.\n   *\n   * If the redirection target doesn't depend on the button clicked, it's a\n   * better option to define it directly on the Form component. In that case,\n   * using handleSubmit() instead of handleSubmitWithRedirect is fine.\n   *\n   * @example\n   *\n   * <Button onClick={() => handleSubmitWithRedirect('edit')}>\n   *     Save and edit\n   * </Button>\n   */\n\n  var handleSubmitWithRedirect = useCallback(function (redirectTo) {\n    if (redirectTo === void 0) {\n      redirectTo = redirect;\n    }\n\n    setRedirect(redirectTo);\n    handleSubmit();\n  }, [setRedirect, redirect, handleSubmit]);\n  return render(__assign(__assign({}, props), {\n    handleSubmitWithRedirect: handleSubmitWithRedirect\n  }));\n};\n\nexport default FormWithRedirect;","map":{"version":3,"sources":["/node_modules/ra-core/esm/form/FormWithRedirect.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","React","useRef","useCallback","useEffect","useMemo","Form","arrayMutators","useInitializeFormWithRecord","useWarnWhenUnsavedChanges","sanitizeEmptyValues","getFormInitialValues","useDispatch","setAutomaticRefresh","FormContextProvider","FormWithRedirect","_a","debug","decorators","defaultValue","destroyOnUnregister","form","initialValues","initialValuesEqual","_b","keepDirtyOnReinitialize","_c","mutators","record","render","save","saving","_d","subscription","defaultSubscription","validate","validateOnBlur","version","warnWhenUnsavedChanges","_e","shouldSanitizeEmptyValues","props","redirect","onSave","formGroups","setRedirect","newRedirect","current","setOnSave","newOnSave","formContextValue","getGroupFields","name","registerGroup","unregisterGroup","registerField","source","group","fields","Set","add","Array","from","unregisterField","console","warn","delete","finalInitialValues","submit","values","finalRedirect","undefined","sanitizedValues","createElement","value","key","onSubmit","formProps","FormView","submitting","pristine","valid","invalid","dispatch","handleSubmit","handleSubmitWithRedirect","redirectTo"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport * as React from 'react';\nimport { useRef, useCallback, useEffect, useMemo } from 'react';\nimport { Form, } from 'react-final-form';\nimport arrayMutators from 'final-form-arrays';\nimport useInitializeFormWithRecord from './useInitializeFormWithRecord';\nimport useWarnWhenUnsavedChanges from './useWarnWhenUnsavedChanges';\nimport sanitizeEmptyValues from './sanitizeEmptyValues';\nimport getFormInitialValues from './getFormInitialValues';\nimport { useDispatch } from 'react-redux';\nimport { setAutomaticRefresh } from '../actions/uiActions';\nimport { FormContextProvider } from './FormContextProvider';\n/**\n * Wrapper around react-final-form's Form to handle redirection on submit,\n * legacy defaultValue prop, and array inputs.\n *\n * Requires a render function, just like react-final-form\n *\n * @example\n *\n * const SimpleForm = props => (\n *    <FormWithRedirect\n *        {...props}\n *        render={formProps => <SimpleFormView {...formProps} />}\n *    />\n * );\n *\n * @typedef {Object} Props the props you can use (other props are injected by Create or Edit)\n * @prop {Object} initialValues\n * @prop {Function} validate\n * @prop {Function} save\n * @prop {boolean} submitOnEnter\n * @prop {string} redirect\n * @prop {boolean} sanitizeEmptyValues\n *\n * @param {Props} props\n */\nvar FormWithRedirect = function (_a) {\n    var debug = _a.debug, decorators = _a.decorators, defaultValue = _a.defaultValue, destroyOnUnregister = _a.destroyOnUnregister, form = _a.form, initialValues = _a.initialValues, initialValuesEqual = _a.initialValuesEqual, _b = _a.keepDirtyOnReinitialize, keepDirtyOnReinitialize = _b === void 0 ? true : _b, _c = _a.mutators, mutators = _c === void 0 ? arrayMutators : _c, // FIXME see https://github.com/final-form/react-final-form/issues/704 and https://github.com/microsoft/TypeScript/issues/35771\n    record = _a.record, render = _a.render, save = _a.save, saving = _a.saving, _d = _a.subscription, subscription = _d === void 0 ? defaultSubscription : _d, validate = _a.validate, validateOnBlur = _a.validateOnBlur, version = _a.version, warnWhenUnsavedChanges = _a.warnWhenUnsavedChanges, _e = _a.sanitizeEmptyValues, shouldSanitizeEmptyValues = _e === void 0 ? true : _e, props = __rest(_a, [\"debug\", \"decorators\", \"defaultValue\", \"destroyOnUnregister\", \"form\", \"initialValues\", \"initialValuesEqual\", \"keepDirtyOnReinitialize\", \"mutators\", \"record\", \"render\", \"save\", \"saving\", \"subscription\", \"validate\", \"validateOnBlur\", \"version\", \"warnWhenUnsavedChanges\", \"sanitizeEmptyValues\"]);\n    var redirect = useRef(props.redirect);\n    var onSave = useRef(save);\n    var formGroups = useRef({});\n    // We don't use state here for two reasons:\n    // 1. There no way to execute code only after the state has been updated\n    // 2. We don't want the form to rerender when redirect is changed\n    var setRedirect = function (newRedirect) {\n        redirect.current = newRedirect;\n    };\n    /**\n     * A form can have several Save buttons. In case the user clicks on\n     * a Save button with a custom onSave handler, then on a second Save button\n     * without custom onSave handler, the user expects the default save\n     * handler (the one of the Form) to be called.\n     * That's why the SaveButton onClick calls setOnSave() with no parameters\n     * if it has no custom onSave, and why this function forces a default to\n     * save.\n     */\n    var setOnSave = useCallback(function (newOnSave) {\n        typeof newOnSave === 'function'\n            ? (onSave.current = newOnSave)\n            : (onSave.current = save);\n    }, [save]);\n    var formContextValue = useMemo(function () { return ({\n        setOnSave: setOnSave,\n        getGroupFields: function (name) { return formGroups.current[name] || []; },\n        registerGroup: function (name) {\n            formGroups.current[name] = formGroups.current[name] || [];\n        },\n        unregisterGroup: function (name) {\n            delete formGroups[name];\n        },\n        registerField: function (source, group) {\n            if (group) {\n                var fields = new Set(formGroups.current[group] || []);\n                fields.add(source);\n                formGroups.current[group] = Array.from(fields);\n            }\n        },\n        unregisterField: function (source, group) {\n            if (group) {\n                if (!formGroups.current[group]) {\n                    console.warn(\"Invalid form group \" + group);\n                }\n                else {\n                    var fields = new Set(formGroups.current[group]);\n                    fields.delete(source);\n                    formGroups.current[group] = Array.from(fields);\n                }\n            }\n        },\n    }); }, [setOnSave]);\n    var finalInitialValues = getFormInitialValues(initialValues, defaultValue, record);\n    var submit = function (values) {\n        var finalRedirect = typeof redirect.current === undefined\n            ? props.redirect\n            : redirect.current;\n        if (shouldSanitizeEmptyValues) {\n            var sanitizedValues = sanitizeEmptyValues(finalInitialValues, values);\n            return onSave.current(sanitizedValues, finalRedirect);\n        }\n        else {\n            return onSave.current(values, finalRedirect);\n        }\n    };\n    return (React.createElement(FormContextProvider, { value: formContextValue },\n        React.createElement(Form, { key: version, debug: debug, decorators: decorators, destroyOnUnregister: destroyOnUnregister, form: form, initialValues: finalInitialValues, initialValuesEqual: initialValuesEqual, keepDirtyOnReinitialize: keepDirtyOnReinitialize, mutators: mutators, onSubmit: submit, subscription: subscription, validate: validate, validateOnBlur: validateOnBlur, render: function (formProps) { return (React.createElement(FormView, __assign({}, props, formProps, { record: record, setRedirect: setRedirect, saving: formProps.submitting || saving, render: render, save: save, warnWhenUnsavedChanges: warnWhenUnsavedChanges }))); } })));\n};\nvar defaultSubscription = {\n    submitting: true,\n    pristine: true,\n    valid: true,\n    invalid: true,\n};\nvar FormView = function (_a) {\n    var render = _a.render, warnWhenUnsavedChanges = _a.warnWhenUnsavedChanges, setRedirect = _a.setRedirect, props = __rest(_a, [\"render\", \"warnWhenUnsavedChanges\", \"setRedirect\"]);\n    // if record changes (after a getOne success or a refresh), the form must be updated\n    useInitializeFormWithRecord(props.record);\n    useWarnWhenUnsavedChanges(warnWhenUnsavedChanges);\n    var dispatch = useDispatch();\n    useEffect(function () {\n        dispatch(setAutomaticRefresh(props.pristine));\n    }, [dispatch, props.pristine]);\n    var redirect = props.redirect, handleSubmit = props.handleSubmit;\n    /**\n     * We want to let developers define the redirection target from inside the form,\n     * e.g. in a <SaveButton redirect=\"list\" />.\n     * This callback does two things: handle submit, and change the redirection target.\n     * The actual redirection is done in save(), passed by the main controller.\n     *\n     * If the redirection target doesn't depend on the button clicked, it's a\n     * better option to define it directly on the Form component. In that case,\n     * using handleSubmit() instead of handleSubmitWithRedirect is fine.\n     *\n     * @example\n     *\n     * <Button onClick={() => handleSubmitWithRedirect('edit')}>\n     *     Save and edit\n     * </Button>\n     */\n    var handleSubmitWithRedirect = useCallback(function (redirectTo) {\n        if (redirectTo === void 0) { redirectTo = redirect; }\n        setRedirect(redirectTo);\n        handleSubmit();\n    }, [setRedirect, redirect, handleSubmit]);\n    return render(__assign(__assign({}, props), { handleSubmitWithRedirect: handleSubmitWithRedirect }));\n};\nexport default FormWithRedirect;\n"]},"metadata":{},"sourceType":"module"}